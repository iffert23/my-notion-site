# EDR 초급 교육자료 정리

---

[EDR 초급 교육 요약](EDR%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/EDR%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%20%EC%9A%94%EC%95%BD%201c3788fef6c4814b989fcd1d8dc49948.md)

[NAC 분석 방법 — Genians Documentation 5.0.55
 documentation](https://docs.genians.com/release/ko/troubleshoot/diagnosis-method.html)

## **제품설치**

장비접속방법 준비물 : USB to Serial converter, Serial console(Rj45 type, DB9 type)

Console 설정 : Baud rate 115200 / Data bits 8 / Parity None / Stop bits 1

- Serial 장비 접속오류 시 확인 방법
    1. Serial Cable 연결위치 확인
    2. Serial Cable 연결 부위 접속 확인 (헐거운지/케이블이 정상인지/잘 꽂혀있는지 확인)
    3. 접속 설정 중 잘못된 부분 확인 (protocol, port, baud rate, data bits, parity, stop bits)
    4. 전원 연결 및 연결 LED 확인 (장비 후면 전원버튼, 장비 전면 전원LED)

SSH 설정 : port 3910 / Firewall None / Username USER ID

- SSH2 장비 접속오류 시 확인 방법
    1. LAN port LED 확인
    2. ICMP를 통한 통신 확인 (ping)

최초 접속 시 계정정보 admin / genian

ID 설정 조건 : 4~31자 사이
PW 설정 조건 : 9자 이상, 숫자&대문자 포함

디스크 확인 : 파티션 확인 fdisk -l / 마운트 확인 df -k → /disk/data 마운트 여부

장비 설정모드 : Exec Mode(>), Privileged Mode(#), Configuration Mode((config)#), (config-batch)), Shell Mode($)

웬만한 명령어들은 리눅스 명령어와 용도가 비슷함

제품 이미지

- 릴리즈명 : C(개발버전), B(베타), R(안정성ok)
- 이미지 종류 : CT64(64bit OS기반 정책서버이미지), SS64(64bit OS기반 네트워크 센서 이미지)
- 이미지 파일 이름 구조 : [제품명]-[대상]-[타입]-[리비전넘버]-[버전정보]-[날짜].img
- 업그레이드 순서 : 이미지 다운로드→이미지 업로드→업그레이드 진행→업그레이드 확인
- 이미지 업로드 순서
    1. 업그레이드 대상 장비 Config 모드 접속
    2. interface 명령어 사용해서 IP설정
    3. SSH 접속후 Shell Mode 접속
    4. Zmodem Upload 명령어를 사용하여 업로드  (rz 명령어 입력 후 표시되는 팝업창에서 파일 선택)

OS 이미지 업로드 권장 폴더 : /tmp

- 이미지 업그레이드 순서
    1. 명령어 입력 (geniup -cf)
    2. 업그레이드 후 실행 옵션 선택
    
    geniup 명령어 사용해야함
    
    -c : 이미지 정합성 체크 X, -f : 이미지 파일 지정
    
    메이저 이미지 업그레이드는 Shell Mode에서 수행해야 함 (옵션사용)
    
- Ver 5.0 업그레이드 시 적용되는 모드
    1. Interactive Wizard
    2. Manual Configuration

RMA

- 물리적 하드웨어 장애 시 신청
- 신청 선택→신청 정보 입력→장애 확인→제출
- 장비 수령위치 : 서울경기 제외한 지역 퀵서비스 요청→근처 고속터미널/KTX역까지만 발송

---

## **구성요소**

구성 별 기능

- 정책서버
    - NAC 정책 설정 기능 제공
    - 다수의 네트워크 센서 & 에이전트 관리
    - 정책 및 노드의 실시간 상태 값 저장
    - 발생되는 감사 로그 기록(저장)
    - AAA : 인증(Authentication), 권한 부여(Authorization), 계정관리(Accounting)
    - 구성요소 : Web server(Centerd,Tomcat,Apache, gdcid), Database server(Mysqld), Log server(Elasticsearch,Tomcat), Radius(Radiusd)
- 네트워크 센서
    - 네트워크 차단/허용 기능, 사용자 역할 기반의 네트워크 → 통제
    - 이상 트래픽 발생 단말 탐지
    - 구성요소 : Web server(Apache), Enforce(gdcid)

구성 별 공통 동작 데몬 : sshd, sensord, promond

- 무선 센서
    - Wireless 환경에서 발생되는 정보 수집 → 접속 리스트 기반으로 접속AP 제어
    - 구성요소 : Access point, Enforce
- 에이전트
    - 사용자 PC의 무결성 검증 → OS패치, 백신, 필수 S/W 설치 검증
    - 단말 정보 수집 → Hardware, Software 정보 및 운영체제 정보 수집
    - 구성요소(지원OS) : Windows, MAC, Linux

![<시스템 아키텍쳐>](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled.png)

<시스템 아키텍쳐>

구성 간 네트워크 통신 (포트 확인)

![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%201.png)

정책서버 (3871 keep alive, 443 Genian Data Sync SMS 전송, 37 NTP Server Sync)

네트워크센서 (3870 keep alive, 514 SYSLOG 전송, 443 정책 수신, 80 파일 다운로드)

무선센서 (3870 keep alive, 514 SYSLOG 전송, 443 정책 수신)

에이전트 (3870 keep alive, 443 80 SOAP 통신 파일 다운로드, 8080 PMS)

---

## 구성방안

- **정책서버**
    1. 단일 구성
        - 하나의 장비에 모든 모듈로 정책 서버를 구성함
        - 비용절감 / 해당 시스템 장애 시 전체 또는 일부 서비스의 중단
    2. 분리 구성
        - 정책 서버 구성 요소를 다수의 장비로 분리
        - 모듈별 별도의 장비에 구성
        - 성능향상 / 해당 시스템 장애 시 전체 또는 일부 서비스의 중단
    3. HA(고가용성) 구성
        - 정책서버 구성 요소를 이중화 구성
        - 고가용성을 위해 Slave(Secondary) 장비 추가 구성
        - 성능 향상, 고장 방지 / 비용 상승
- **네트워크 센서**
    1. 단일 구성
        - 네트워크 대역 수량이 설정 포트 수보다 적거나 같거나
        - 물리적인 인터페이스로 구성
        
        > **[Config]**
        device-id [UUID] (자동생성)
        
        interface eth0 address [IP] [SubnetMask]
        interface eth0 gateway [IP]
        ip default-gateway [IP]
        
        ip name-server [IP]
        node-server ip [IP]
        > 
    2. 멀티 구성 (802.1q)
        - 네트워크 대역 수량이 설정 포트 수보다 많을 때
        - Trunk Port 연결
        
        > **[Config]**
        device-id [UUID] (자동생성)
        > 
        > 
        > interface eth0.[VLANID] address[IP] [SubnetMask]
        > interface eth0.[VLANID] gateway [IP]
        > interface eth0.[VLANID] address [IP] [SubnetMask]
        > interface eth0.[VLANID] gateway [IP]
        > Interface eth0 vlan [VLANID],[VLANID]
        > 
        > ip default-gateway [IP]
        > ip name-server [IP]
        > 
        > node-serverip [IP]
        > 
    3. HA 구성
        
        ![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%202.png)
        
        - VRRP를 센서 두 개에다가 설정
        - Slave(Secondary) 장비 추가 구성
        
        > **[Config] Manual 모드**
        device-id [UUID] (자동생성)
        
        interface eth0 address [IP] [SubnetMask]
        interface eth0 gateway [IP]
        ip default-gateway [IP]
        
        ip name-server [IP]
        node-server ip [IP]
        > 
        
        > **[Config] HA구성 Master**
        debug category 0xffffffff
        debug vrrpd field 0x31d
        
        device-id [UUID] (자동생성)
        
        interface eth0 address [IP] [SubnetMask]
        interface eth0 gateway [IP]
        interface eth0 ha group[Number]
        interface eth0 ha linkupdelay [Number]
        interface eth0 ha nopreempt enable
        interface eth0 ha priority [Number]
        interface eth0 ha timeout [Number]
        interface eth0 ha virtual-ip [IP]
        
        ip default-gateway [IP]
        ip name-server [IP]
        
        node-server ip [IP]
        > 
        
        > **[Config] HA구성 Slave**
        debug category 0xffffffff
        debug vrrpd field 0x31d
        
        device-id [UUID] (Master device-id)
        
        interface eth0 address [IP] [SubnetMask]
        interface eth0 gateway [IP]
        interface eth0 ha group[Number]
        interface eth0 ha linkupdelay [Number]
        interface eth0 ha nopreempt enable
        interface eth0 ha priority [Number]
        interface eth0 ha timeout [Number]
        interface eth0 ha virtual-ip [IP]
        
        ip default-gateway [IP]
        ip name-server [IP]
        
        node-server ip [IP]
        > 
    4. Mirror 구성
        
        ![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%203.png)
        
        - 센서 interface 1, 2에 L3 연결, 하나는 Mirroring Port로 사용, 하나는 Manage Port로 사용
        - L3 기반 IP 제어를 위해 구성
        
        > 네트워크센서와 연결된 스위치 Mirroring 설정
        네트워크센서 Mirror 인터페이스 설정
        > 
    5. Bonding 구성
        
        ![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%204.png)
        
        - 센서 interface 1, 2에 각각 하나씩 L3 연결
        - 스위치 고가용성을 위한 연결
        
        > **[Config] Bonding**
        device-id [UUID] (자동생성)
        
        bonding parameters “mode=1
        primary=eth0”
        
        interface bond0 address [IP]
        Interface bond0 gateway [IP]
        Interface bond0 slave eth0,eth1
        
        ip default-gateway [IP]
        ip name-server [IP]
        
        node-server ip [IP]
        > 
    
    단일 구성
    
    ---
    
    ## 구성별 설정방법
    
    1. **Interactive Wizard 모드**
        
        단일구성 → Web, DB, Log
        
        [Configuration]
        data-server
        debug
        device-id(자동생성)
        interface
        default GW
        DNS
        log-server
        node-server
        ntp server
        
        분리구성 → Web + DB, Log
        
        [Configuration - WEB]
        data-server
        debug
        device-id(자동생성)
        interface
        default GW
        DNS
        log-server
        node-server
        ntp server
        system-locale ko
        
        [Configuration - DB + LOG]
        data-server
        debug
        device-id(자동생성)
        interface
        default GW
        DNS
        log-server
        node-server
        ntp server
        
    2. **Manual Configuration 모드**
        
        단일구성
        
        case 1) Web + DB + Log + Radius
        
        [Configuration]
        data-server
        debug
        device-id(자동생성)
        interface
        default GW
        DNS(name server)
        log-server
        
        case 2) Web + DB + Log
        
        [Configuration]
        data-server
        debug
        device-id(자동생성)
        interface
        default GW
        DNS(name server)
        log-server
        
        ---
        
        분리구성
        
        case 1) Web + DB, Log, Radius
        
        case 2) Web + DB, Log
        
        case 3) Web, DB, Log + Radius
        
        case 4) Web + DB + Log + Radius
        
        case 5) Web + DB + Log
        
        case 6) Web + DB,Log + Radius
        
        ---
        
        [Configuration - DB + LOG + RADIUS]
        data-server
        debug
        device-id(자동생성)
        interface
        default GW
        DNS
        log-server
        node-server
        
        [Configuration - WEB + DB + LOG]
        data-server (enable, access-list, password, username)
        debug (senterd)
        device-id(자동생성)
        interface
        default GW
        DNS (name server)
        log-server (enable, cluster-name, publish-port)
        node-server
        
        [Configuration - DB + LOG]
        data-server (enable, access-list, password, username)
        device-id(자동생성)
        interface
        default GW
        DNS (name server)
        log-server (enable, cluster-name, cluster-peers, publish-port)
        node-server IP
        
        [Configuration - DB]
        data-server (enable, IP, PW, Username)
        device-id(자동생성)
        interface (IP, GW) 
        default GW
        DNS (name server)
        node-server (IP)
        
        [Configuration - LOG]
        device-id(자동생성)
        interface
        default GW
        DNS (name server)
        log-server (enable, cluster-name, cluster-peers, publish-port)
        node-server ip
        
        [Configuration - WEB]
        data-server (ip, PW, Username)
        debug (centerd)
        device-id(자동생성)
        interface (ip, GW, management/node-server enable, 
        default GW
        DNS (ip name server)
        log-server (cluster-name, ip)
        
        [Configuration - RADIUS]
        data-server (IP, PW, Username)
        device-id(자동생성)
        interface (IP, GW, radius-server enable) 
        ip default GW
        DNS (ip name server)
        node-server (IP)
        
        ---
        
        HA구성
        
        <VRRP> 설정 옵션
        interface eth(_) ha ~
        debug vrrpd category
        debug vrrpd field ~
        
        | 옵션 | 비고 |
        | --- | --- |
        | 1. Group | Group 0~255 |
        | 2. Linkup delay | Interface Up Delay (STP에 따라 설정) |
        | 3. No Virtual MAC | 00:00:5E:00:01:XX(Group Number) |
        | 4. No preempt | Priority에 따른 Master 선점 설정 |
        | 5. Priority | Master 선점 Priority 값 |
        | 6. Timeout | Advertisement 횟수 (1sec 1회) |
        | 7. Virtual IP | 가상 IP 설정 |
        
        <Mysql Replication> 설정 옵션
        data-server replica ~
        
        | 옵션 | 비고 |
        | --- | --- |
        | 1. Enable | Replication 활성화 |
        | 2. Serverid | Replica 서버 ID설정 |
        | 3. Username | Replica Master DB 사용자 계정 설정 |
        | 4. Password | Replica Master DB 사용자 패스워드 설정 |
        | 5. Masterhost | Replica Master IP 설정 |
        | 6. Port | Replica Master Port 설정 |
        
        <Elasticsearch Cluster> 설정 옵션
        log-server cluster-
        
        | 옵션 | 비고 |
        | --- | --- |
        | 1. Cluster-Name | Cluster 동기화 이름 설정 |
        | 2. Cluster-Peers | Cluster동기화 대상 IP주소 설정 |
        | 3. Publish-Port | Cluster 통신 인터페이스 설정 |
        
        case 1) [Web, DB, Log, Radius] *2
        
        case 2) [Web, DB, Log] *2
        
        case 3) [Web + DB, Log, Radius] *2
        
        case 4) [Web + DB, Log] *2
        
        case 5) [Web, DB, Log +Radius] *2
        
        case 6) [Web + DB + Log + Radius] *2
        
        case 7) [Web + DB + Log] *2
        
        case 8) [Web + DB, Log + Radius] *2
        
    
    ---
    

## 구성별 Configuration

- Policy + Database + Radius + LOG
    
    
    genian(config)#debug centerd all
    
    genian(config)#interface eth0 address [IP] [Subnetmask]
    genian(config)#interface eth0 gateway [IP]
    genian(config)#ip default-gateway [IP]
    genian(config)#ip name-server [IP]
    
    genian(config)#data-server username [string]
    genian(config)#data-server enable
    genian(config)#data-server password [string]
    genian(config)#data-server access-list [IP/CIDR]
    
    genian(config)#log-server=enable
    genian(config)# log-server publish-port eth0
    genian(config)#log-server_cluster-name=GENIAN
    (자동생성)
    
    genian(config)#interface eth0 management-server enable
    genian(config)#interface eth0 node-server enable
    genian(config)#Interface eth0 radius-server enable
    
    genian(config)#device-id 6029b2d8-b21e-1001-8001-009
    (자동생성)
    
    CENTERD 데몬 디버그 설정
    
    인터페이스 IP, Subnet mask
    인터페이스 게이트웨이
    장비 기본 게이트웨이
    장비 도메인네임서버
    
    DB 계정 설정
    DB 서버 구동 명령
    DB서버 접속 계정 PW
    DB 접근 권한 설정
    
    로그서버 설정
    
    관리UI 구동 설정
    SOAP서버 구동 설정
    RADIUS서버 구동 설정
    

---

- Database + LOG
    
    
    genian(config)#interface eth0 address [IP] [Subnetmask]
    genian(config)#interface eth0 gateway [IP]
    
    genian(config)#ip default-gateway [IP]
    genian(config)#ip name-server [IP]
    
    genian(config)#data-server username [string]
    genian(config)#data-server enable
    genian(config)#data-server password [string]
    genian(config)#data-server access-list [IP/CIDR]
    
    genian(config)#log-server=enable
    genian(config)#log-server_cluster-name=GENIAN
    (자동생성)
    
    genian(config)#node-server ip [IP]
    
    인터페이스 IP,Subnetmask
    인터페이스 GW
    
    장비 기본 GW
    장비 DNS
    
    DB 계정 구성
    DB 계정 구동 명령
    DB PW설정
    DB 접근 권한 설정
    
    Log Server 구동
    
    정책서버(Node Server) 지정
    

---

- Policy + Radius
    
    
    genian(config)#debug centerd all
    
    interface eth0 address [IP] [Subnetmask]
    interface eth0 gateway [IP]
    ip default-gateway [IP]
    ip name-server [IP]
    ntp server [IP]
    
    data-server ip [IP]
    data-server username [string]
    data-server password [string]
    
    log-server ip [IP]
    
    interface eth0 management-server enable
    interface eth0 node-server enable
    Interface eth0 radius-server enable
    
    디버그 설정
    
    인터페이스 IP, Subnetmask
    인터페이스 GW
    장비 기본 GW
    장비 DNS
    시간 동기화 서버
    
    DB서버 IP지정
    DB서버 접속계정 Username
    DB서버 접속계정 Password
    
    로그서버 IP 지정
    
    정책서버 관리UI 구동
    SOAP서버 구동
    Radius서버 구동
    
    ---
    
- Single sensor 구성 설정
    
    
    interface eth0 address [IP] [Subnetmask]
    interface eth0 gateway [IP]
    ip default-gateway [IP]
    ip name-server [IP]
    ntp server [IP]
    
    node-server ip [IP]
    
    인터페이스 IP, Subnetmask
    인터페이스 GW
    장비 기본 GW
    장비 DNS
    시간 동기화 서버
    
    정책서버 지정
    
    ---
    
- Multi sensor 구성 설정
    
    
    genian(config)# interface eth0 vlan [60,86,87,135]
    genian(config)# interface eth0.[135] address [IP] [Subnetmask]
    genian(config)# interface eth0.[135] gateway [IP]
    genian(config)# interface eth0.[60] address [IP] [Subnetmask]
    genian(config)# interface eth0.[60] gateway [IP]
    genian(config)# interface eth0.[86] address [IP] [Subnetmask]
    genian(config)# interface eth0.[86] gateway [IP]
    genian(config)# interface eth0.[87] address [IP] [Subnetmask]
    genian(config)# interface eth0.[87] gateway [IP]
    
    genian(config)# ip default-gateway [IP]
    genian(config)# ip name-server [IP]
    
    genian(config)# node-server ip [IP]
    
    VLAN 정의
    VLAN별 IP, Subnet
    VLAN별 GW
    
    장비 기본 GW
    장비 DNS
    
    정책서버 지정
    
    ---
    
- 이중화 설정 [Primary]
    
    
    debug centerd all
    debug vrrpd all
    
    interface eth0 address [IP] [SubnetMask]
    interface eth0 gateway [Gateway IP]
    ip default-gateway [Gateway IP]
    ip name-server [DNS IP]
    
    data-server username [ID]
    data-server enable
    data-server password [password]
    data-server access-list [IP/CIDR]
    data-server replica serverid [master서버 ip 끝자리]
    data-server replica enable
    
    log-server=enable
    log-server_cluster-name=GENIAN (자동생성)
    log-server publish-port eth0
    
    log-server cluster-peers [secondary log server ip]
    
    interface eth0 management-server enable
    interface eth0 node-server enable
    
    superadmin [ID] [PASSWORD] [EMAIL]
    
    interface eth0 ha group [master서버 ip 끝자리]
    interface eth0 ha priority 200
    interface eth0 ha virtual-ip [관리자 웹 콘솔용 IP]
    
    설정 순서 꼭 지켜야 함
    
    HA 설정 중 devid 관련error가 발생할 경우 Console Session 종료 후 재접속
    
    DB replication을 위해서는 data-server access-list에 secondary server의 IP가 포함되어야 함.
    
    ---
    
- 이중화 설정 [Secondary]
    
    
    debug centerd all
    debug vrrpd all
    
    device-id [Primary Device id]
    
    interface eth0 address [IP] [SubnetMask]
    interface eth0 gateway [Gateway IP]
    ip default-gateway [Gateway IP]
    ip name-server [DNS IP]
    ntp server [NTP server IP]
    
    data-server username [ID]
    data-server enable
    data-server password [password]
    data-server access-list [IP/CIDR]
    data-server replica serverid [second서버 ip 끝자리]
    data-server replica masterhost [primary DB IP]
    data-server replica enable
    
    log-server enable
    log-server_cluster-name=GENIAN (자동생성)
    log-server publish-port eth0
    
    log-server cluster-peers [secondary log server ip]
    
    interface eth0 management-server enable
    interface eth0 node-server enable
    
    superadmin [ID] [PASSWORD] [EMAIL]
    
    interface eth0 ha group [Number]
    interface eth0 ha priority 100
    interface eth0 ha virtual-ip [IP]
    
    interface eth0 management-server enable
    interface eth0 node-server enable
    
    설정 순서 꼭 지켜야 함
    
    HA 설정 중 devid 관련error가 발생할 경우 Console Session 종료 후 재접속
    
    DB replication을 위해서는 data-server access-list에 secondary server의 IP가 포함되어야 함.
    
    HA 설정 중 
    nopreempt
    linkupdelay
    timatout
    옵션은 필요에 따라 적용해야 함
    
    ---
    

## 정책 설정

WebUI URL : https://[정책서버IP]:8443/mc2 → 상위 메뉴에서 ‘정책’선택

- 그룹
    - 노드 그룹 : 노드정책/제어 정책 대상 지정할 때 사용
        - 상태그룹(제어정책, 장치제어정책), 정책그룹(노드정책추가됨)
        - 노드 그룹 조건 (해당 조건이 아닌 조건들은 모두 상태 그룹 조건)
            
            ![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%205.png)
            
        - 상태 그룹 조건 예시 : NAT, 접속AP, 시스템, 노드그룹, 열린포트, 트래픽 등
        - 무선랜 그룹 : 노드그룹 내 ‘장비내 무선랜’, ‘접속AP’ 조건에 사용
            - 기본정보 : ID(이름지정), 설명, 적용 모드(사용유무), 감사 로그
            - 조건
            
            ![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%206.png)
            
        - 사용자 그룹 : (ID, 설명, 적용모드)
            - 조건 : 사용자 정보
- 객체
    - 네트워크 (네트워크 주소)
    - 서비스 (서비스 포트)
    - 시간 (시간 객체)
    - 권한 (네트워크 객체, 서비스 객체, 시간 객체)
- 정책
    - 노드정책, 제어정책, 802.1x정책, 무선랜정책, Windows업데이트정책, 장치제어정책, 컴플라이언스정책
        - **무선랜정책, Windows업데이트정책, 장치제어정책** 은 Agent Action(Agent Plugin)
        - 단일정책 : 노드정책, 제어정책, 802.1x정책, Windows업데이트정책
        - 복수정책 : 무선랜정책, 장치제어정책, 컴플라이언스정책
    - 노드 정책
        1. 인증정책 (비밀번호 인증방식 : LocalDB, Radius, LDAP, POP3, IMAP, SMTP, Webhook)
        2. 에이전트정책 (에이전트 사용유무)
        3. 관리정책 (신규노드 호스트명 제한, 비활성 노드의 삭제 기간 설정)
        4. 노드/에이전트액션 (정의된 액션을 수행하도록 할당)
        5. 위험감지 (위험 탐지 이벤트 할당)
        
        > **NAC에서 사전에 정의한 11가지 위험 이벤트**
        1) AD HOC 네트워크 연결
        2) ARP Bomb
        3) ARP Spoofing
        4) MAC/IP Clone
        5) Malware Detection
        6) Port Scan
        7) 비 정상적인 DHCP서버 감지
        8) 센서 MAC Clone
        9) 알 수 없는 서비스 요청
        10) 잘못된 게이트웨이 사용
        11) SNMP 차단요청
        > 
    - 제어정책
        - 노드그룹+권한(네트워크객체,서비스객체,시간객체)+(제어옵션+제어액션)
        - 네트워크 센서를 이용하여 차단함
        - 제어옵션
            - 정책 별 CWP 페이지 설정
            - SNMP 연동기능→스위치 포트 차단
            - Radius Coa 사용 스위치 제어
        - 제어 액션
            - 단말 방화벽 ACL 설정
            - 차단 시 사용자 알림 메시지 발송
            - 단말 전원 강제종료
            - 네트워크 인터페이스 사용중지
        - Radius 정책
            - 그룹 조건 설정을 위해 수신되는 패킷 : Radius Access-Request
            
            ![그룹 조건 설정](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%207.png)
            
            그룹 조건 설정
            
            - 속성 할당을 위해 수신되는 패킷 : Radius Access-Accept
            
            ![속성 할당](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%208.png)
            
            속성 할당
            
        - 무선랜 정책
            - 정책-노드정책-노드액션
            - AP, Client Profile
        - Windows  업데이트 정책
        - 장치 제어 정책
            - 노드 그룹+차단장치 설정+예외장치 설정
        - 컴플라이언스 정책
            - 다수의 노드 그룹을 지정하여 노드 그룹 포함 여부를 O/X로 표시
            - 제어와 관련 없는 정책

## 에이전트

설치 방법 : http://[정책서버IP]/agent

기본 설치 경로 : %ProgramFiles%\Geni\Genian

에이전트 다운 전환 시간 : KeepAlive 전송주기*5

에이전트 설치 과정

1. 기존 프로그램 중지
2. 이전 프로그램 삭제
3. 새로운 파일 복사
4. 배포 인증서 설치
5. 기본 설정 저장
6. 새로운 버전 설치
7. 설치 정보 저장
8. 프로그램 시작

![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%209.png)

![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%2010.png)

동작타입

- 단독 type 플러그인 : 노드정책>플러그인 할당 시 동일한 플러그인 할당 불가
- 멀티 type 플러그인 : 노드정책>플러그인 할당 시 동일한 플러그인 할당 가능

plugin 설정/적용 순서

플러그인 수행 조건 설정(프로세스, 파일, 레지스트리, 서비스, 인증 사용자, 서비스팩 버전, 시스템)

→ 플러그인 선택 및 설정

![Untitled](../NAC/NAC%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Untitled%2011.png)

→ 기타 항목 설정 (수행주기, 적용언어, 적용OS 등)

→ 노드 정책 할당

Plugin 정보 수집 방식 : Windows API, Registry, WMI Query, 기타 표준 정보(EDID)

- 단독 Type 플러그인
    - ARP 플러그인
        - Static ARP 차단 : static으로 설정된 ARP List 관리 (물리적 주소 바꾸고 정적→동적)
        - Anti ARP Spoofing : 시스템에서 정의한 static ARP List 관리 (정적 ARP 고정, 충돌방지)
    - DNS 제어
        - 임의로 설정된 DNS 주소를 강제화 관리 (자동 DNS 할당 설정 / DNS 주소 고정)
        - Hosts File에 내용 관리 (C:\Windows\System32\drivers\etc, DNS 캐시→ hosts.ics→ hosts→ DNS Query)
    - IE 보안 옵션 제어
        - 일반 → 홈페이지/임시 인터넷 파일 삭제 설정
        - 보안 → ActiveX 부분, 팝업차단, 신뢰할 수 있는 사이트 설정 제어
        - 연결 → 프록시 사용 유/무 설정
        - 내용 → 폼 자동완성 기능 제어 유/무 설정
        - 추가 ) 미사용 ActiveX
    - Malware Detector
        - 정보 수집 동의 / 수집 제외 경로 설정
        - 백신 프로그램(?)에게 수집 정보를 전송하면 해당 정보를 분석한 정보를 서버에 전달해준다
    - TCP 세션 검사
        - 세션 정보 전송주기
        - 인터페이스 제어(임계치 제어)
    - Windows
        - 방화벽 제어 : 자동 규칙 / 커스텀 제어
        - 보안설정 : 방화벽 강제화(인바운드 차단정책), 원격 데스크탑 사용중지 강제화, 복구 콘솔 자동 로그온, 자동 실행 제어
        - 보안설정 : 시간 동기화 서버 강제화, Windows XP 예약 작업, 윈도우 게스트 계정 제어
        - 전원관리 : 절전모드 해제 시 암호 보호, 화면 끄기 / 절전모드 대기시간, 빠른 시작 켜기
        - 정책 / windows 업데이트 정책 등 업데이트 관련 기
    - 그 외 : 하드웨어 정보수집, 프린터 정보수집, 네트워크 공유 폴더 등등..
    - 유선 인증 관리자
        - EAP-MSCHAPv2,EAP-GTC,스마트카드 또는 기타 인증서(네트워크 인증 방법)
        - EAP 기반의 인증을 유선에 적용할 수 있도록 프로파일 설정 배포
        - 권한 없는 네트워크 액세스로 대체
        - 자격증명 기억
- 멀티 Type 플러그인
    - WMI 정보 수집
        - NameSpace
        - WMI Qeury 결과 수집
    - 사용자 알림 메시지
        - 메시지 제목 설정, 클릭 동작, 내용(상세 메시지) / URL 설정, 팝업창 고정, 메시지 타입, 메시지 확인 알림
    - 수행 조건만 검사
        - 프로세스, 파일, 레지스트리, 서비스팩 버전, 서비스, 시스템, 인증 사용자
    - 시스템 종료
    - 프로그램 제거
    - 필수 소프트웨어 검사
        - 백신 프로그램 (AhnLab V3, Avira, Bitdefender,F-Secure, AVG, ESET, GData, ViRobot,K7, Kaspersky, Malwarebyte, McAfee, Cylance)
        - 디스크 암호화 프로그램 (AVG, Bitdefender, BestCrypt, GDATA, BCArchive, Kaspersky, McAfee)
        - 패치 관리 프로그램 (F-Secure, Kaspersky)

---

- 기타
    
    [NAC란? (+NAC의 필요성)](EDR%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/NAC%EB%9E%80%20(+NAC%EC%9D%98%20%ED%95%84%EC%9A%94%EC%84%B1)%201c3788fef6c4815f9136e6b83e0c889f.md)
    
    [Genian NAC 5.0](EDR%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC/Genian%20NAC%205%200%201c3788fef6c481f09d38f7126208e32d.md)