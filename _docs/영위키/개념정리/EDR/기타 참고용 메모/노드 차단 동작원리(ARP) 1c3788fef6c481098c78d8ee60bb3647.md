# 노드 차단 동작원리(ARP)

---

![Untitled](../../NAC/%EA%B8%B0%ED%83%80%20%EC%B0%B8%EA%B3%A0%EC%9A%A9%20%EB%A9%94%EB%AA%A8/%EB%85%B8%EB%93%9C%20%EC%B0%A8%EB%8B%A8%20%EB%8F%99%EC%9E%91%EC%9B%90%EB%A6%AC(ARP)/Untitled.png)

1. 차단된 단말이 가지고 있는 모든 ARP 정보의 MAC주소를 센서의 MAC주소로 변조 (ARP 포이즈닝)
2. 차단 대상이 아니지만 차단단말과 같은 broadcast domain에 있는 노드들에게 차단 단말의 ARP MAC주소를 센서의 MAC으로 변조해서 전달함.

번외) redirection 과정

![Untitled](../../NAC/%EA%B8%B0%ED%83%80%20%EC%B0%B8%EA%B3%A0%EC%9A%A9%20%EB%A9%94%EB%AA%A8/%EB%85%B8%EB%93%9C%20%EC%B0%A8%EB%8B%A8%20%EB%8F%99%EC%9E%91%EC%9B%90%EB%A6%AC(ARP)/Untitled%201.png)

1. 차단된 단말이 WEB접속을 시도한다
2. 차단 단말의 모든 ARP정보는 센서의 MAC으로 변조되어 있기 때문에 센서가 해당 요청을 전달받는다.
3. 센서가 DNS 또는 WEB으로 정보를 질의하고 돌아온 응답을 차단단말에게 전달한다
4. 차단 단말이 WEB접속을 시도할 때 센서는 차단 단말의 3-way handshake를 drop하고 센서 본인이 WEB과 handshake를 진행한다.
5. 이 때 받는 SYN+ACK 응답이 차단단말에게 전달되게끔 센서가 헤더에 차단단말의 IP와 MAC을 포함하여 L2로 전달한다. → 통신 맺어짐
6. 이후 차단단말이 HTTP요청을 함 → 센서가 받음 → 차단 단말의 정책을 확인하고 비인가 단말로 식별되면 200OK 패킷 안에 CWP페이지 링크를 포함하여 차단 단말에게 전달
7. 차단단말이 전달받은 CWP페이지 링크로 HTTP 요청을 수행하면 정책서버가 CWP 페이지를 리다이렉션