# DB

---

**기본 접속**

@shell

`mysql -u [username] -p`

password 입력

`use ALDER;`

wating — Database changed

---

**쿼리**

JIRA 쿼리문 작성예제 : [https://ims.genians.com/jira/browse/TS-25497](https://ims.genians.com/jira/browse/TS-25497)

쿼리 수정 방법 : ALTER ~~ (`ALTER VIEW [테이블명] AS SELECT [컬럼명] FROM [참고테이블명];`)

- 계정생성, 권한할당
    
    `CREATE USER [사용자ID]@'%' identified by '패스워드';` //% 기호는 모든host ip 허용
    
    `GRANT SELECT ON ALDER.[테이블명] TO jiran@'%';` 테이블마다 따로따로 권한 넣어줘야 함
    
- 부서 (dept)
    
    **부서코드 / 부서명 / 상위부서명 / ??**
    
    `CREATE VIEW vwNAC_DEPT AS SELECT` 
    
    `CustomValue AS DEPT_ID,` 
    
    `CustomDisp AS DEPT_NAME,` 
    
    `Option2 AS ParentDEPT_ID,` 
    
    `CustomOrder AS DEPT_ORDER` 
    
    `FROM CustomData` 
    
    `WHERE CustomKey = 'dept';`
    
- 사용자 (user)
    
    **ID / 사용자명 / 사용자 부서 / 사용자 부서코드 / 사용자 직급코드 / 사용자 직급**
    
    `CREATE VIEW vwNAC_USER AS SELECT` 
    
    `USER_ID AS USER_ID,` 
    
    `USER_NAME AS USER_NAME,` 
    
    `USER_DEPT AS USER_DEPTID,` 
    
    `USER_POSITION AS POSITION_CODE,` 
    
    `USER_POSITION_NAME AS POSITION_NAME`
    
    `FROM vwUSER;`
    
- IP정보 (IP info)
    
    **IP / MAC / 인증사용자ID**
    
    `CREATE VIEW vwNAC_IPINFO AS SELECT` 
    
    `vwNODELIST_VALID_ALL.NL_IPSTR AS IP,` 
    
    `vwNODELIST_VALID_ALL.NL_MAC AS MAC,` 
    
    `vwNODELIST_VALID_ALL.NL_AUTHUSER AS [인증사용자ID]` 
    
    `FROM vwNODELIST_VALID_ALL` 
    
    `WHERE vwNODELIST_VALID_ALL.NL_AUTHUSER <> '';`
    
- 직급정보 (position)
    
    **직급코드 / 직급명**
    
    `CREATE VIEW TEMP_POSI AS SELECT`
    
    `CustomValue AS POSITION_CODE,`
    
    `CustomDisp AS POSITION_NAME`
    
    `FROM CustomData`
    
    `WHERE CustomKey = 'position';`
    

---

- 인증사용자 매치
    
    `UPDATE NODELIST SET NL_AUTHUSER = '[사용자ID]' WHERE NL_IPSTR = '[사용자IP]';`
    
- 특정 컬럼의 특정 데이터 변경 (update)
    
    update [테이블명] set [컬럼명]=’변경값’ where [기준컬럼명]=’기준데이터’
    
    (예시) `update USER set USER_NAME='김지' where USER_ID='jykim';`
    
    → userid가 jykim이고 username이 김지영인데 여기서 username을 김지로 바꿀거야
    
    ⇒ 결과 : [jykim 김지영] → [jykim 김지]
    

---

- **기타 조회 및 삭제 쿼리**
    
    DB 버전확인 : @shell → `mysql -V`
    
    ---
    
    특정 사용자 권한 조회 : `SHOW GRANT FOR 아이디@'호스트';`
    
    접속중인 계정 권한 확인 : `SHOW GRANTS FOR CURRENT_USER;`
    
    계정 조회 : `SELECT host, user, password FROM USER;`
    
    계정(유저) 삭제 : `DROP USER ‘사용자아이디’;` / `DELETE FROM USER WHERE USER = ‘사용자아이디’;`
    
    특정 권한 삭제 : `REVOKE ALL ON ALDER.[테이블명] FROM 사용자아이디;`
    
    모든 권한 삭제 : `REVOKE ALL ON *.* FROM 사용자아이디;`
    
    ---
    
    특정 (뷰)테이블의 쿼리문 조회 : `show create view/table [테이블명];`
    
    특정 테이블 컬럼(필드) 조회 : `DESCRIBE [테이블명];`
    
    특정 테이블 정보값 확인 : `select *(모든컬럼, 또는 특정 컬럼) from [테이블명];`
    
    특정 테이블의 특정 컬럼의 특정 데이터 조회 : `select 컬럼 from 테이블 where 컬럼명='데이터';` (복수의 데이터라면 AND, OR 가능)
    
    전체 테이블 조회 : `SHOW TABLES;`
    
    뷰 테이블 삭제 : `DROP VIEW [뷰테이블명];`
    
    테이블 삭제 : `DROP TABLE [테이블명];`
    
    디바이스ID 중복조회 : `select NL_DEVID, NL_IPSTR, NL_MAC from vwNODELIST_VALID WHERE NL_DEVID not LIKE CONCAT("%",REPLACE(NL_MAC,":","")) and FIND_IN_SET('NLF_HAVEAGENT',DL_FLAGS) > 0;`
    
    특정 테이블의 특정 컬럼 데이터 삭제 : `delete from [테이블명] where [컬럼명] = '데이터값' ;`
    
    데이터 수동으로 넣기 : `insert into ADMIN (컬럼1, 컬럼2) Values ('데이터1', '데이터2') ;`
    
    ---
    
    - 컬럼명으로 테이블 찾기
        
        `select TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME LIKE '%user%';`
        
        1. user라는 단어가 포함된 모든 컬럼 관련 정보를 모든 스키마에서 찾음
        
        `select TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME LIKE 'user%' and TABLE_SCHEMA='ALDER';`
        
        1. user라는 단어가 포함된 컬럼 관련 정보를 ALDER에서만 찾음 (USER, user_admin 이런거)
        
        `select TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where COLUMN_NAME LIKE 'user';`
        
        1. user라고만 되어있는 컬럼 관련 정보를 모든 스키마에서 찾음 (컬럼명 user)
    
- 관리자 계정 패스워드 분실
    
    UPDATE USER SET USER_PASSWORD = **['패스워드 HMAC-SHA256 암호값']** WHERE USER_ID=**['계정ID']**;
    
    **예)** UPDATE USER SET USER_PASSWORD = **'41fa99916a000fb049d13e0d3ea1fb0efd6e960d9f4d538c4f9683f033c71ace-405001a530b893ee'** WHERE USER_ID=**'sminfo'**;
    
    **Tip.** Smi$%8324 > 암호화 > 41fa99916a000fb049d13e0d3ea1fb0efd6e960d9f4d538c4f9683f033c71ace-405001a530b893ee