# CLI

장비 CLI configuration

---

[https://docs.genians.com/nac/5.0/release/ko/](https://docs.genians.com/nac/5.0/release/ko/)

[구성별 Configuration](EDR%20%EC%B4%88%EA%B8%89%20%EA%B5%90%EC%9C%A1%EC%9E%90%EB%A3%8C%20%EC%A0%95%EB%A6%AC%201c3788fef6c4815ea8a5fdb387062d1f.md) 

## config

### 버전 업그레이드 /일반(GNOS)

1 .기본 cli 설정

Manual Configuration (2) 선택
`ID : admin
 PW : Smi$%8324`
로그인

2.en 모드
로그인

3. 현재버전 확인
show ver

4. 버전 업그레이드 쉘모드 이동
`@shell
ifconfig eth1 192.168.1.100 netmask 255.255.255.0 up` 
pc의 IP를 192.168.1.x 로 변경
PC랜카드와 장비의 eth1 인터페이스와 다이렉트로 연결
별도의 탭 open 후 [ssh 192.168.1.100 3910] 입력하여 접근

5. 이미지 파일 업로드

`@shell
cd /tmp
rz -b [PC에서 파일선택]`

6. 업그레이드 실행
`geniup -dcf [업로드한 파일] (NAC 하고 tab 치면 바로 나옴)
y
y
자동reboot`

확인>> `show version`

### 버전 업그레이드 /범용(UBUNTO)

1. 기본 cli 설정

Manual Configuration (2) 선택
`ID : admin
 PW : Smi$%8324`
로그인

2. 관리자 권한 획득
`sudo su`

3. exec 모드 접속
`gnlogin`

4. en 모드
로그인

5. 현재버전 확인
`show ver`

6. 버전 업그레이드 쉘모드 이동
`@shell
ifconfig eth1 192.168.1.100 netmask 255.255.255.0 up` 
→ pc의 IP를 192.168.1.x 로 변경
PC랜카드와 장비의 eth1 인터페이스와 다이렉트로 연결
별도의 탭 open 후 [ssh 192.168.1.100 3910] 입력하여 접근

7. 이미지 파일 업로드
`cd /tmp`

`pwd //*현재 위치 확인*//
rz -b`
파일 선택 후 업로드

8. 업그레이드 실행
`geniup -dcf [업로드한 파일] (NAC 하고 tab 치면 바로 나옴)
y
y`
리부팅

확인>> `show version`

ex) user / admin123!

`gnlogin`

>`en`

`admin123!`

### 서버 config

`debug centerd all`

`interface eth0 address [IP] [SUBNET]
 interface eth0 gateway []
 ip default-gateway []
 ip name-server []`

`data-server username []
 data-server enable
 data-server password []
 data-server access-list all`

`log-server version 7` (범용OS만 해당)

`log-server enable
 log-server publish-port eth0`

`interface eth0 management-server enable
 interface eth0 node-server enable`

`superadmin [username] [password] [e-mail address]`

### 센서 config vlan 있/없

`en`

`conf t`

`debug sensord all`

`interface eth0 vlan 40,50,60`

`interface eth0.40 address 192.168.160.210 255.255.255.0`

`interface eth0.40 gateway 192.168.160.254`

`interface eth0.50 address 192.168.161.210 255.255.255.0`

`interface eth0.50 gateway 192.168.160.254`

`interface eth0.60 gateway 192.168.160.254`

`interface eth0.60 address 192.168.161.210 255.255.255.0`

`ip default-gateway 192.168.160.254`

`ip name-server 192.168.10.72`

`node-server ip 192.168.0.60`

—————————————————————————————————

`en
 conf t`

`debug sensord all`

`interface eth0 address 192.168.160.210 255.255.255.0`

`interface eth0 gateway 192.168.160.254`

`ip default-gateway 192.168.160.254`

`ip name-server 192.168.10.72`

`node-server ip 192.168.0.60`
—————————————————————————————————

확인>> `show config`

- **console, enable admin 변경**
    
    `conf t`
    
    `consoleadmin [username] [PW]`
    
    ![Untitled](../NAC/CLI/Untitled.png)
    
    `enable [username] [PW]`
    
    ![Untitled](../NAC/CLI/Untitled%201.png)
    
    //consoleadmin과 enable의 username이 동일하면 됨
    
- **복원**
    1. do restore [백업할 파일명]
    2. 컨피그 먼저 복원 → 컨피그 빼고 나머지 복원 순서.
    
    ![Untitled](../NAC/CLI/Untitled%202.png)
    
    ![Untitled](../NAC/CLI/Untitled%203.png)
    
- **Shell**
    
    **sysinspect 실행**
    GNOS : @shell → sysinspect.sh
    UBUNTU : sudo su → cd /usr/geni/tools OR /disk/data/new → ./sysinspect.sh
    
    **syscollect 파일 추출**
    
    WEBUI : [시스템] - [해당 장비IP] - [작업선택] - [시스템 로그 수집] - [정책서버, 센서 프로세스 상태, 에이전트 로그 포함], 파일 암호 저장
    GNOS : @shell → syscollect.sh
    UBUNTU : sudo su → cd /usr/geni/tools → ./syscollect.sh → IMS no → y → y
    
    **외부 통신 가능 환경에서 지라 직접 접속해서 펌웨어 다운로드하는 법**
    wget --no-check-certificate (해당 펌웨어 다운로드 링크 복사)
    ex) [https://download.geninetworks.com/NAC/GNOS/v4.0.1/RELEASE/NAC-SS64-R-119564-4.0.156.0912.img](https://download.geninetworks.com/NAC/GNOS/v4.0.1/RELEASE/NAC-SS64-R-119564-4.0.156.0912.img)
    
    tail -f /var/log/centerd
    
- **그 외**
    - **power of**
    `stop service`
    ****`@shell
     poweroff -f`
    - **reboot**
        
        `reboot`
        
    - **reset**
        
        `@shell`
        
        `reset-factory`
        
        `y`
        
        `factory reset`
        
    - **ACL**
        
        `data-server access-list ip ~ / all`
        
    - [https://ims.genians.com/jira/browse/TS-38606](https://ims.genians.com/jira/browse/TS-38606)
    - **버전 확인(장비, WEB, DB, WAS)**
    [https://ims.genians.com/jira/browse/TS-39813](https://ims.genians.com/jira/browse/TS-39813)
    - **덤프 뜨는법**
    `tcpdump -eni [eth0] host [IP] and port [port]`
    - **NTP TIME 확인**
    `ntpdate [ntp서버 ip]`
    - tail -f /var/log/centerd
    - **ARP IP, MAC static 고정**
    arp -s 172.16.249.1 00:40:5c:8b:33:90
    - **Ubuntu 계정 관리**
    [https://www.notion.so/geni-knowledge/Q-ubuntu-OS-f8d3a825475c481a9e487561d00da4e9](https://www.notion.so/f8d3a825475c481a9e487561d00da4e9?pvs=21)

[사설 SSL 인증서 갱신](CLI/%EC%82%AC%EC%84%A4%20SSL%20%EC%9D%B8%EC%A6%9D%EC%84%9C%20%EA%B0%B1%EC%8B%A0%201c3788fef6c4815abcc9dd6bb0a0335c.md)

폐쇄망 환경에서 범용OS 패키지 일부 업그레이드 방법
[https://ims.genians.com/jira/browse/TS-36535](https://ims.genians.com/jira/browse/TS-36535)