# NAC 초급 교육 (집체교육 요약)

교육 일자 : 23/4/18~4/20

- **참고**
    
    [**https://www.genians.co.kr/support/online_edu**](https://www.genians.co.kr/support/online_edu)
    

---

### **4/18**

**-제품설명**

내부 관계자 및 내부 보안관리 부재로 인한 피해 대비

네트워크 가시성, 사용자 가시성, 단말 가시성

구성 필수요소 : Policy server(통합관리), Network sensor(차단센서), Agent(장치사용통제) 지점은 지점에 대한 로컬센서 설치해야 함

가시성(대시보드), 분류(다양한 조건,통계화면), 통제(알림,차단,교정), 리포트(로그필터링,전송등)

Agent-less(플랫폼 분류,접근제어,네트워크정보), Agent(동영상,ppt참고) → 접근제어방식에서의 차이 있음, Agent가 설치되어있으면 더 많은 컨트롤 가능

특장점 : SAML(Suite, Okta) 인증 연동, 업무용PC 외부사용제어, 외부DB서버연동, 사용자PC 안정성 보장(Agent), 다양한 보안프로그램들과 연동

**-NAC 구성요소**

정책서버(Web server,DB Server,Log Server,Radius), 네트워크 센서(Web Server,Enforcer),무선 센서(Access Point,Enforce), Agent(Windows,Linux,Mac OS)

구성요소의 종류, 해당 구성요소에 대한 명령어 암기 필요

시스템 아키텍쳐들이 이런것들이 있다~ 하는 것만 알아두면 좋음(추후 사진첨부)

Genian Data 종류 되게 많음.. 알고있으면 좋다. (FWDB:펌웨어디비)(5.0.53 이상부터는 제조사에서 공지하는 내용이 즉각적으로 올라가는 기능)

VLAN 갯수와 성능은 상관이 없고, 실 사용자수가 얼마나 많은지에 따라 성능이 조금 느려질 수 있음.

환경적인 요소에 따라 미러센서 구성하는 방법도 있음. (Host 수가 적을 때)

Keep Alive 패킷 디폴트는 2분

**-정책서버 구성방안**

웹서버, DB서버, Radius, 로그서버

단일구성 : 비용절감, 정책서버 하나에 문제가 생기면 다른 요소도 해제됨

분리구성 : 하나로 사용했을 때보다 가용량이 커짐, 성능(처리속도) 빨라짐, DB랑 웹이 살아있다면 나머지는 가능한데 나머지 단점은 단일구성이랑 똑같음

HA(고가용성)구성 : 비용이 비쌈, Active-Standby방식, 성능 빠름, 구성요소 중 하나가 죽어도 페일오버 기능으로 인해서 서비스 중단 없이 사용이 가능하다. → VRRP 마스터,슬레이브 구성

여기까지 chapter 2 PPT에 내용 다 있음

---

**-NAC ARP 동작방식 → [ARP 문서 참고](../../OSI%207%20Layer/Layer3%20(Network)/ARP%20e04b1eb55b0b4f979cbee3611a676f7a.md)**

ARP를 통한 단말탐지

ARP를 이용한 네트워크 차단 방식 : 도착지 노드에서는 NAC센서의 IP와 MAC Address와 스위치의 IP와 MAC Address를 따로 알고 있었는데 차단 패킷이 들어가면 스위치의 IP,MAC이 아닌 NAC센서의 IP, MAC으로 ARP Reply를 보낸다. (추후 이미지첨부)

---

**-제품설치**

콘솔접속 : Baud rate 115200

ssh : ssh2 port 3910

디폴트계정 admin / genian

>모양,#모양 CLI모드 , $모양 Shell모드

이미지 : BETA(테스트환경), RELEASE(안정화버전)

종류 : CT64→정책서버, SS64→센서, 우분투→우분투

슬랙요청이나 JIRA에서 발급받을 수 있음

-설정방법

매뉴얼 ppt 참고

**-유지보수**

SYSTEM 점검 

DB 백업(Privilege→ do backup all) & 복구(Privilege→show backup → do restore [백업파일명])

Log 백업&복구(Web UI→엘라스틱서치)

장비 초기화 : shell모드 → reset-factory-sh

시간 동기화 : ntp server [x.x.x.x] / ntpdate~~ (ppt 확인)

---

### 4/19

**Genian NAC 초기설정**

vmrc://[IP]/?moid=
geni
qwe123!@#

https://[IP]:8443/mc2/adv
@1wntpdy (@1주세요)

**-script**
debug centerd all

interface eth0 address [IP] [SUBNET]
interface eth0 gateway [ ]
ip default-gateway [ ]
ip name-server [ ]

data-server username [ ]
data-server enable
data-server password [ ]
data-server access-list all

log-server enable
log-server publish-port eth0

interface eth0 management-server enable
interface eth0 node-server

superadmin [username] [password] [e-mail address]

---

**-WebUI 설명**

접속링크 : https://[IP주소]**:8443**/mc2/

- 감사→리포트→로그리포트 : 지정된 시간에 해당 필터에 해당되었던 노드 로그 확인 가능
- 감사→리포트→사용자정의리포트 : (NAC DB의 쿼리) 원하는 정보를 리포트형태로 출력함(엑셀파일 등)
- 정책→정책→노드정책 : 역할별 노드의 정보수집 (노드별 정책확)
- 상태그룹-제어정책 사용 , 정책그룹-노드정책 사용 권장
- 시스템→시스템→라이선스 : 라이선스 등록
- 시스템→시스템→시스템관리 : 시스템에 등록되어 있는 장비들의 현황을 확인하고 관리(노드아님)

---

**실습> 노드 정책 만들기**

1. 정책→노드→작업선택→(노드정책 전용)생성→변경정책 적용 (⇒제어정책 생성)
2. 노드 정책→작업선택→생성(ID/이름설정→노드그룹 할당)→변경정책 적용
3. https://[정책서버IP]/cwp2 접속

---

### 4/20

**-제어정책**

권한객체→ 네트워크 객체, 서비스 객체, 시간객체로 구분

제어액션 : 노드가 제어정책에 할당되었을 때 함께 수행할 수 있는 액션

---

**실습>제어정책 변경하기**

1. 정책→노드→노드정책 : 어제 만든 정책,기본정책에서 인증방법을 비밀번호 인증으로 바꾼다
2. 정책→제어정책 : 미인증차단을 사용안함에서 사용함으로 바꾼다.
3. 관리→노드→노드리스트 : 제어정책이 미인증차단으로 바뀌어있는지 확인한다.
4. https://[정책서버IP]/cwp2 접속해서 인증버튼 클릭 후 관리자계정으로 로그인한다.
5. 관리→노드→노드리스트 : 제어정책이 미인증차단에서 기본정책으로 바뀌어있는지 확인한다.

---

**실습>위험감지테스트**

1. arp-ping.exe 파일을 C:\ 경로에 저장
2. 제어정책 생성 : ID는 위험감지테스트→노드그룹에서 위험감지노드 선택→변경정책적용
3. 노드정책설정-위험감지할당 : 내 노드가 속한 노드정책 설정→ARP-Bomb 추가→감지기간,요청횟수 설정→변경정책적용
4. CMD창 열어서 arp-ping 172.29.200.180 -i 0.1 -n 1000 후 10초 뒤 Ctrl+C
5. 노드리스트 확인(관리→노드) 후 내 노드 제어정책이 위험감지노드가 되었는지 확인(제어정책이 위험감지테스트로 되어있을거임)

---

-IP 관리 기능

충돌보호 : 지정한 IP에 MAC을 고정하여 사용한다

변경금지 : 지정한 MAC에 IP를 고정하여 사용한다

-DHCP기능

로컬 : 로컬네트워크에 DHCP구성 센서의 범위 내에서 IP할당

로컬&리모트 : 기본적으로는 센서가 IP할당 수행. 근데 센서가 IP할당 불가능한 상황이면 정책서버가 DHCP 기능을 서비스함. 스위치에서 IP Helper Address 설정 필수

리모트 : 정책서버에서만 IP를 할당할 때 설정함. 스위치에서 IP Helper Address 설정 필수

---

실습>MAC 변경금지, IP 충돌보호 테스트

---

-에이전트 확인경로

5.0v

C:\Program Files\Geni\Genian\Logs

4.0.1v

C:\Program Files (x86)\Geni\Genian\Logs

-SOAP ERROR 오류나면 확인하는 방법

443 port 

tcpdump -i host 172….. and host 3870 / 3871

Agent Log 확인

Gnstart→GnAgent

에이전트 삭제방법

에이전트 우클릭→삭제→WEBUI관리→신청→에이전트 인증코드 발급→에이전트코드 입력→인증코드 받기→에이전트 인증코드 입력 후 삭제버튼→삭제됨